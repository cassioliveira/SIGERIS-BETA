<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:agendador="http://xmlns.jcp.org/jsf/composite/components/listagens"
      template="/WEB-INF/templates/Layout.xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"> 

    <ui:define name="content">

        <h:form id="formSearchOpenedSchedules">

            <p:growl id="messages" autoUpdate="true"/>

            <p:fieldset legend="#{msg.scheduling}s ativos" styleClass="centerFieldsetLegend">
                <p:toolbar>
                    <f:facet name="left">
                        <p:commandButton icon="ui-icon ui-icon-refresh" 
                                         value="Atualizar" 
                                         style="text-align: right" 
                                         class="buttonNewRegister" 
                                         action="#{schedulingBean.checkDateScheduledRoomNow}"
                                         update="@form" id="refreshButton"/>
                    </f:facet>

                    <f:facet name="right">
                        <p:button value="#{msg.newScheduling}" 
                                  style="text-align: right" 
                                  icon="ui-icon ui-icon-plus" 
                                  styleClass="botao-novo-cadastro"
                                  class="buttonNewRegister" 
                                  rendered="#{schedulerChanger}"
                                  outcome="/Agendador/agendamento/cadastro-agendamento"/>

                        <p:button value="Agendamentos finalizados" 
                                  style="text-align: right" 
                                  class="buttonClosedSchedulings"
                                  rendered="#{schedulerChanger}"
                                  outcome="/Agendador/agendamento/listar-agendamentos-finalizados"/>
                    </f:facet>
                </p:toolbar>    

                <agendador:datatableAgendamentos id="datatableOpenedScheduling" 
                                                 schedulingList="#{schedulingBean.openedSchedulings}" 
                                                 endingDate="#{scheduling.forecastSchedulingDateTime}"
                                                 datatableHeaderEndingDate="PrevisÃ£o fim"/>
            </p:fieldset>

            <p:poll listener="#{schedulingBean.checkDateScheduledRoomNow}" update="@form" interval="300"/>

            <p:blockUI id="blockSchedulingForm" block="datatableOpenedScheduling" trigger="refreshButton">
                <p:graphicImage library="images" name="loading.gif"/>
            </p:blockUI>

        </h:form>

    </ui:define>
</ui:composition>