<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:agendador="http://xmlns.jcp.org/jsf/composite/components/listagens"> 

    <h:form id="formSearchOpenedSchedules">

        <p:growl id="messages" autoUpdate="true"/>

        <p:fieldset legend="#{msg.scheduling}s ativos" styleClass="centerFieldsetLegend">
            <p:toolbar>
                <f:facet name="left">
                    <p:commandButton icon="ui-icon ui-icon-refresh" value="Atualizar" style="text-align: right" class="buttonNewRegister" action="#{schedulingBean.checkDateScheduledRoomNow}"
                                     update="@form" id="refreshButton"/>
                </f:facet>
                <f:facet name="right">
                    <p:button outcome="/Agendador/agendamento/cadastro-agendamento" value="#{msg.newScheduling}" style="text-align: right" class="buttonNewRegister"/>
                    <p:button outcome="/Agendador/agendamento/listar-agendamentos-finalizados" value="Agendamentos finalizados" style="text-align: right" class="buttonClosedSchedulings"/>
                </f:facet>
            </p:toolbar>    

            <agendador:datatableAgendamentos id="datatableOpenedScheduling" schedulingList="#{schedulingBean.openedSchedulings}" endingDate="#{scheduling.forecastSchedulingDateTime}"
                                             datatableHeaderEndingDate="PrevisÃ£o fim"/>
        </p:fieldset>

        <p:poll listener="#{schedulingBean.checkDateScheduledRoomNow}" update="@form" interval="3600"/>

        <p:blockUI id="blockSchedulingForm" block="datatableOpenedScheduling" trigger="refreshButton">
            <p:progressBar id="progressBarRefresh" widgetVar="pbClient" style="width: 500px;"/>
            <!--<p:graphicImage library="images" name="loading.gif"/>-->
        </p:blockUI>

    </h:form>

    <script type="text/javascript">
        function start() {
            PF('startButton1').disable();

            window['progress'] = setInterval(function () {
                var pbClient = PF('pbClient'),
                        oldValue = pbClient.getValue(),
                        newValue = oldValue + 10;

                pbClient.setValue(pbClient.getValue() + 10);

                if (newValue === 100) {
                    clearInterval(window['progress']);
                }


            }, 1000);
        }

        function cancel() {
            clearInterval(window['progress']);
            PF('pbClient').setValue(0);
            PF('startButton1').enable();
        }
    </script>
</html>